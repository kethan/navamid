"use strict";function k(n,c){if(n instanceof RegExp)return{keys:!1,pattern:n};var p,s,i,o,e=[],u="",h=n.split("/");for(h[0]||h.shift();i=h.shift();)p=i[0],p==="*"?(e.push("wild"),u+="/(.*)"):p===":"?(s=i.indexOf("?",1),o=i.indexOf(".",1),e.push(i.substring(1,~s?s:~o?o:i.length)),u+=!!~s&&!~o?"(?:/([^/]+?))?":"/([^/]+?)",~o&&(u+=(~s?"?":"")+"\\"+i.substring(o))):u+="/"+i;return{keys:e,pattern:new RegExp("^"+u+(c?"(?=$|/)":"/?$"),"i")}}function w(n,c,p=()=>{}){var s,i,o=[],e={},u=[],h=p;e.req={url:{},params:{}},e.res={run:t=>e.run(t),redirect:(t,r)=>e.route(t,r)};var L=e.format=function(t){return t&&(t="/"+t.replace(/^\/|\/$/g,""),s.test(t)&&t.replace(s,"/"))};return n="/"+(n||"").replace(/^\/|\/$/g,""),s=n=="/"?/^\/+/:new RegExp("^\\"+n+"(?=\\/|$)\\/?","i"),e.route=function(t,r){t[0]=="/"&&!s.test(t)&&(t=n+t),history[(t===i||r?"replace":"push")+"State"](t,null,t)},e.use=function(...t){return u=[...u,...t],e},e.on=function(t,...r){return(t=k(t)).fns=[...u,...r],o.push(t),e},e.run=function(t){var r=0,f={},d,a;if(t=L(t||location.pathname)){for(t=t.match(/[^\?#]*/)[0],i=t;r<o.length;r++)if(d=(a=o[r]).pattern.exec(t)){for(r=0;r<a.keys.length;)f[a.keys[r]]=d[++r]||null;let v=[...a.fns],l=(m,g)=>{try{let E=v.shift();E?E(m,g,y=>y?h(y,m,g):l(m,g)):h(null,m,g)}catch(E){h(E,m,g)}};return e.req.params=f,e.req.url=t,l(e.req,e.res),e}c&&c(t,e.req,e.res)}return e},e.listen=function(t,r){x("push"),x("replace");function f(a){r&&r(),e.run()}function d(a){var v=a.target.closest("a"),l=v&&v.getAttribute("href");a.ctrlKey||a.metaKey||a.altKey||a.shiftKey||a.button||a.defaultPrevented||!l||v.target||v.host!==location.host||l[0]=="#"||(l[0]!="/"||s.test(l))&&(a.preventDefault(),e.route(l))}return addEventListener("popstate",f),addEventListener("replacestate",f),addEventListener("pushstate",f),addEventListener("click",d),e.unlisten=function(){removeEventListener("popstate",f),removeEventListener("replacestate",f),removeEventListener("pushstate",f),removeEventListener("click",d)},e.run(t)},e}function x(n,c){history[n]||(history[n]=n,c=history[n+="State"],history[n]=function(p){var s=new Event(n.toLowerCase());return s.uri=p,c.apply(this,arguments),dispatchEvent(s)})}module.exports=w;
