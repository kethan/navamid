"use strict";function k(n,c){if(n instanceof RegExp)return{keys:!1,pattern:n};var p,r,i,o,e=[],u="",h=n.split("/");for(h[0]||h.shift();i=h.shift();)p=i[0],p==="*"?(e.push("wild"),u+="/(.*)"):p===":"?(r=i.indexOf("?",1),o=i.indexOf(".",1),e.push(i.substring(1,~r?r:~o?o:i.length)),u+=!!~r&&!~o?"(?:/([^/]+?))?":"/([^/]+?)",~o&&(u+=(~r?"?":"")+"\\"+i.substring(o))):u+="/"+i;return{keys:e,pattern:new RegExp("^"+u+(c?"(?=$|/)":"/?$"),"i")}}function w(n,c,p=()=>{}){var r,i,o=[],e={},u=[],h=p;e.req={url:{},params:{}},e.res={run:e.run,redirect:e.route};var L=e.format=function(t){return t&&(t="/"+t.replace(/^\/|\/$/g,""),r.test(t)&&t.replace(r,"/"))};return n="/"+(n||"").replace(/^\/|\/$/g,""),r=n=="/"?/^\/+/:new RegExp("^\\"+n+"(?=\\/|$)\\/?","i"),e.route=function(t,s){t[0]=="/"&&!r.test(t)&&(t=n+t),history[(t===i||s?"replace":"push")+"State"](t,null,t)},e.use=function(...t){return u=[...u,...t],e},e.on=function(t,...s){return(t=k(t)).fns=[...u,...s],o.push(t),e},e.run=function(t){var s=0,f={},d,a;if(t=L(t||location.pathname)){for(t=t.match(/[^\?#]*/)[0],i=t;s<o.length;s++)if(d=(a=o[s]).pattern.exec(t)){for(s=0;s<a.keys.length;)f[a.keys[s]]=d[++s]||null;let v=[...a.fns],l=(m,g)=>{try{let E=v.shift();E?E(m,g,y=>y?h(y,m,g):l(m,g)):h(null,m,g)}catch(E){h(E,m,g)}};return e.req.params=f,e.req.url=t,l(e.req,e.res),e}c&&c(t,e.req,e.res)}return e},e.listen=function(t,s){x("push"),x("replace");function f(a){s&&s(),e.run()}function d(a){var v=a.target.closest("a"),l=v&&v.getAttribute("href");a.ctrlKey||a.metaKey||a.altKey||a.shiftKey||a.button||a.defaultPrevented||!l||v.target||v.host!==location.host||l[0]=="#"||(l[0]!="/"||r.test(l))&&(a.preventDefault(),e.route(l))}return addEventListener("popstate",f),addEventListener("replacestate",f),addEventListener("pushstate",f),addEventListener("click",d),e.unlisten=function(){removeEventListener("popstate",f),removeEventListener("replacestate",f),removeEventListener("pushstate",f),removeEventListener("click",d)},e.run(t)},e}function x(n,c){history[n]||(history[n]=n,c=history[n+="State"],history[n]=function(p){var r=new Event(n.toLowerCase());return r.uri=p,c.apply(this,arguments),dispatchEvent(r)})}module.exports=w;
