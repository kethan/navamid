"use strict";function e(e,t){history[e]||(history[e]=e,t=history[e+="State"],history[e]=function(r){var n=new Event(e.toLowerCase());return n.uri=r,t.apply(this,arguments),dispatchEvent(n)})}module.exports=function(t,r,n=(()=>{})){var s,i,u=[],a={},o=[],c=n;a.req={url:{},params:{}},a.res={redirect:(e,t)=>a.route(e,t)};var l=a.format=function(e){return e?(e="/"+e.replace(/^\/|\/$/g,""),s.test(e)&&e.replace(s,"/")):e};return t="/"+(t||"").replace(/^\/|\/$/g,""),s="/"==t?/^\/+/:new RegExp("^\\"+t+"(?=\\/|$)\\/?","i"),a.route=function(e,r){"/"!=e[0]||s.test(e)||(e=t+e),history[(e===i||r?"replace":"push")+"State"](e,null,e)},a.use=function(...e){return o=[...o,...e],a},a.on=function(e,...t){return(e=function(e,t){if(e instanceof RegExp)return{keys:!1,pattern:e};var r,n,s,i,u=[],a="",o=e.split("/");for(o[0]||o.shift();s=o.shift();)"*"===(r=s[0])?(u.push("wild"),a+="/(.*)"):":"===r?(n=s.indexOf("?",1),i=s.indexOf(".",1),u.push(s.substring(1,~n?n:~i?i:s.length)),a+=~n&&!~i?"(?:/([^/]+?))?":"/([^/]+?)",~i&&(a+=(~n?"?":"")+"\\"+s.substring(i))):a+="/"+s;return{keys:u,pattern:new RegExp("^"+a+(t?"(?=$|/)":"/?$"),"i")}}(e)).fns=[...o,...t],u.push(e),a},a.run=function(e){var t,n,s=0,o={};if(e=l(e||location.pathname)){for(e=e.match(/[^\?#]*/)[0],i=e;s<u.length;s++)if(t=(n=u[s]).pattern.exec(e)){for(s=0;s<n.keys.length;)o[n.keys[s]]=t[++s]||null;let r=[...n.fns],i=(e,t)=>{try{let n=r.shift();n?n(e,t,(r=>r?c(r,e,t):i(e,t))):c(null,e,t)}catch(n){c(n,e,t)}};return a.req.params=o,a.req.url=e,i(a.req,a.res),a}r&&r(e,a.req,a.res)}return a},a.listen=function(t){function r(e){a.run()}function n(e){var t=e.target.closest("a"),r=t&&t.getAttribute("href");e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.button||e.defaultPrevented||r&&!t.target&&t.host===location.host&&"#"!=r[0]&&("/"!=r[0]||s.test(r))&&(e.preventDefault(),a.route(r))}return e("push"),e("replace"),addEventListener("popstate",r),addEventListener("replacestate",r),addEventListener("pushstate",r),addEventListener("click",n),a.unlisten=function(){removeEventListener("popstate",r),removeEventListener("replacestate",r),removeEventListener("pushstate",r),removeEventListener("click",n)},a.run(t)},a};
